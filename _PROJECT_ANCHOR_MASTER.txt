; ------------------------------------------------------------------
; GEMINI MEM TAG (DO NOT EVER REMOVE OR EDIT) - MY FULL PATH IS "Pipz_Project_V3_PROJECT_ANCHOR_MASTER.txt"
; ------------------------------------------------------------------

; ------------------------------------------------------------------
; MAINTEMPLATE - _PROJECT_ANCHOR_MASTER.txt
; Version: 1.0.0
; Last change: Initial merge of _PROJECT_ANCHOR.txt and PROJECT_WORKING_NOTES.txt
; Content-Fingerprint: 2026-01-26T19-38-55Z-FHEMOCTK
; ------------------------------------------------------------------

; ------------------------------------------------------------------
; ALL CONTENT MUST GO BELOW THIS POINT (LINES 1-14 RESERVED)
; ------------------------------------------------------------------

; ------------------------------------------------------------------
; SECTION A — PROJECT ANCHOR (CANONICAL AUTHORITY)
; ------------------------------------------------------------------

; ------------------------------------------------------------------
PROJECT ANCHOR: Pipz_Project_V3 (AutoHotkey v2)
; ------------------------------------------------------------------

**UNIFIED SYSTEM ANCHOR (CANONICAL):**
This file defines the *mission intent*, *behavioral constraints*, and *system-level anchoring rules* for Pipz_Project_V3.

>
Structural authority is defined in `_PROJECT_BLUEPRINT.txt`.
Governance and enforcement authority is defined in `AI_PROJECT_INSTRUCTIONS.txt`.
>

This file MUST NOT override Bootstrap v4.

; ------------------------------------------------------------------
1. MISSION STATEMENT & IDENTITY (MUST BE MAINTAINED)
; ------------------------------------------------------------------

Pipz_Project_V3 is a dual-process automation system composed of:

; - **Controller (GUI / Orchestration)**
; - **Worker (Execution / Overlay / Runtime Engine)**

The system is implemented in **AutoHotkey v2** and is governed by strict separation of:
; - Authority
; - Visibility
; - Verification
; - Runtime execution

**CRITICAL IDENTITY RULE**
Every governed file **MUST** declare its identity using:

; GEMINI MEM TAG
; MY FULL PATH IS "Pipz_Project_V3<relative\path>"

Absence, ambiguity, or mismatch of this tag constitutes a **hard stop**.

; ------------------------------------------------------------------
2. BOOTSTRAP & GOVERNANCE DEFERENCE (AUTHORITATIVE)
; ------------------------------------------------------------------

This file **DOES NOT** define initialization behavior.
All initialization, indexing, verification, and authority establishment is governed by:

; - `Pipz_Project_V3\AI_PROJECT_INSTRUCTIONS.txt`
; - `Pipz_Project_V3\BOOTSTRAPv4.txt`

**RULES**
; - Bootstrap v4 is mandatory.
; - Phase ordering is strict.
; - This Anchor MUST NOT introduce alternate search paths, shortcuts, or fallback logic.
; - Any conflict between this file and Bootstrap v4 MUST be resolved in favor of Bootstrap v4.

**NEW CHAT INVOCATION (REFERENCE ONLY)**
For a fresh session cold-start, the required user invocation (including the machine-checkable token `BOOTSTRAP_V4_INIT`) is defined in:

; - `Pipz_Project_V3\AI_PROJECT_INSTRUCTIONS.txt`

This Anchor does not redefine or override invocation enforcement.

; ------------------------------------------------------------------
3. VISIBILITY VS GOVERNANCE DISTINCTION (CLARIFIED)
; ------------------------------------------------------------------

The project contains **three classes of artifacts**:

### A. Governed & Readable
; - `.txt` mirrors
; - Governance documents
; - Registry spreadsheets

These require:
; - Full read access
; - Content-Fingerprint verification
; - Path identity validation

### B. Runtime-Only / Non-Readable (N/A Governance)
Examples:
; - `.ahk`
; - `.ini`
; - `.png`
; - `.key`

These:
; - MUST exist at declared paths
; - MAY be enumerated via Drive
; - MUST NOT be read or reasoned about directly
; - Are classified as **N/A** in `INDEXIDLIST.txt`

### C. Externalized Authority
; - `GLOBAL_REGISTRY_MASTER.gsheet`

This is a **non-negotiable source of truth** and must be fully readable.

; ------------------------------------------------------------------
4. STRUCTURAL & EXPECTED-SET AUTHORITY (REFERENCE ONLY)
; ------------------------------------------------------------------

The expected project structure **and the authoritative Expected Set used for Phase 5** are defined **exclusively** in:

; - `_PROJECT_BLUEPRINT.txt`

This Anchor:
; - May reference structure for contextual understanding only
; - MUST NOT redefine structure
; - MUST NOT define, expand, or reduce the Phase 5 Expected Set
; - MUST NOT drift from the Blueprint

If structure or expected items change:
; - `_PROJECT_BLUEPRINT.txt` is updated first
; - This file is synchronized second

; ------------------------------------------------------------------
5. FINGERPRINT & VERIFICATION BEHAVIOR (DEFERRED)
; ------------------------------------------------------------------

All fingerprint rules, cache-busting behavior, and Fingerprint Challenge Mode (FCM) handling are defined in:

; - `AI_PROJECT_INSTRUCTIONS.txt`

This Anchor:
; - Acknowledges fingerprint supremacy
; - Does not restate enforcement logic
; - Does not introduce alternative validation rules

; ------------------------------------------------------------------
6. SYSTEM INTENT (NON-TECHNICAL ANCHOR)
; ------------------------------------------------------------------

The purpose of Pipz_Project_V3 is to:

; - Maintain deterministic behavior
; - Prevent inference-based drift
; - Enforce literal verification
; - Preserve long-term system integrity across sessions

The AI is a **verifier and executor**, never an estimator.

; ------------------------------------------------------------------
7. SYNCHRONIZATION OBLIGATION (MANDATORY)
; ------------------------------------------------------------------

Any change that affects:
; - Structure
; - Governance
; - Authority
; - Initialization
; - Verification semantics

MUST be synchronized across:
; - `_PROJECT_BLUEPRINT.txt`
; - `_PROJECT_ANCHOR.txt`
; - `AI_PROJECT_INSTRUCTIONS.txt`
; - `INDEXIDLIST.txt` (when applicable)

Partial updates are invalid.

; ------------------------------------------------------------------

END OF PROJECT ANCHOR SECTION (SECTION A)

; ------------------------------------------------------------------
; SECTION B — PROJECT WORKING NOTES (DESIGN & RATIONALE)
; ------------------------------------------------------------------

PURPOSE OF THIS FILE SECTION
--------------------
This document exists to preserve:
- Design intent
- Non-obvious decisions
- Sanity checks
- “Why we did it this way”
- Guardrails against future regression

This file is NOT a checklist.
This file is NOT expected to be concise.
This file SHOULD grow over time.

; ------------------------------------------------------------------
CORE GOALS (DO NOT LOSE SIGHT OF THESE)
; ------------------------------------------------------------------

1. The user interacts with ONE assistant only (Architect).
2. All other AI roles are hidden, automated, and auditable.
3. Governance is enforced by code, not “AI good behavior.”
4. Drift is mechanically impossible, not just unlikely.
5. Every change is attributable, reviewable, and reversible.

If any future change weakens these goals, STOP.

; ------------------------------------------------------------------
WHY SIDECAR GOVERNANCE EXISTS
; ------------------------------------------------------------------

Some file formats are controlled by external tools:
- JSON
- lockfiles
- generated artifacts
- binaries

Governance MUST NEVER break tooling.

Therefore:
- Governance metadata moves to sidecar files
- Sidecars are authoritative
- Runtime artifacts remain pure

This is not a compromise — it is intentional architecture.

; ------------------------------------------------------------------
WHY NOT RELY ON CONTINUE / BUILT-IN AGENTS ALONE
; ------------------------------------------------------------------

Continue is powerful, but:
- It does not natively enforce hidden multi-model chaining
- It cannot prevent a model from “doing too much”
- It cannot hard-enforce mirroring or fingerprint rules

Therefore:
- Continue is treated as the Architect UI only
- Enforcement lives outside the model
- MCP / orchestrator handles invariants

; ------------------------------------------------------------------
ROLE SEPARATION INTENT
; ------------------------------------------------------------------

Architect:
- Thinks
- Plans
- Explains
- Is the ONLY user-facing AI
- NEVER writes directly

Executor:
- Implements literally
- No opinions
- No creativity
- Outputs full files by default

SubSupervisor:
- Mechanical checklist
- Objective PASS / FAIL
- Cannot be overridden

HeadSupervisor:
- Semantic correctness
- Architectural intent validation
- Risk detection
- Cannot override mechanical failure

; ------------------------------------------------------------------
RECENT KEY DECISIONS (IMPORTANT CONTEXT)
; ------------------------------------------------------------------

[2026-01-22]
- MVP orchestrator introduced with bootstrap-only behavior.
- No model calls, no file writes — audit-only.
- Establishes a safe, runnable baseline before hidden chaining is enabled.

[2026-01-22]
- JSON governance finalized via mandatory sidecar files:
  - package.json.governance.txt
  - tsconfig.json.governance.txt
- JSON remains pure and non-fingerprinted by embedded headers.

[2026-01-23]
- Completed port of MirrorAhkToTxt functionality into a VS Code extension:
  - Fingerprint updates on save (governed files, fail-closed gating)
  - Runtime mirroring (.ahk/.ini -> .txt) with AI SOT header
  - Standalone governed fingerprinting for additional file types
  - UTF-8 + UTF-16 mirror encoding compatibility
  - Audit logging into .ORCH_AUDITLOG\mirror\
- Extension packaged (VSIX) and installed into normal VS Code.
- Verified in normal VS Code (no Extension Development Host required for mirroring/fingerprints).

[2026-01-23]
- Noted VS Code Extension Development Host anomaly:
  - Dev Host could open files but refused to open folders/workspaces.
  - Debug console showed DisposableStore disposed warnings.
  - Gemini assisted in resolving the folder-open issue so development can continue.

; ------------------------------------------------------------------
COMMON FAILURE MODES TO WATCH FOR
; ------------------------------------------------------------------

- “We’ll remember to do X later” → NO
- “This file doesn’t need governance” → PROVE IT
- “The AI probably won’t touch that” → INVALID ASSUMPTION
- Silent tool behavior changes (VS Code / extensions)
- Header drift across file types
- JSON accidentally acquiring comments (must remain pure)

; ------------------------------------------------------------------
WHEN TO STOP AND REASSESS
; ------------------------------------------------------------------

STOP if:
- A tool change removes determinism
- A file bypasses governance
- A human must remember a rule instead of tooling enforcing it
- The user must manually switch AI roles for normal operation (end goal is hidden chaining)
- Audit logs become incomplete or optional

; ------------------------------------------------------------------
VS CODE EXTENSION REPACKAGING – DESIGN RATIONALE
; ------------------------------------------------------------------

The pipz-mirror-governance extension is not “just a tool”.
It is an ACTIVE GOVERNANCE ENFORCER.

Therefore:

- Any change to it can silently weaken guarantees if not rebuilt correctly
- VS Code does NOT auto-reload packaged extensions
- Extension Development Host ≠ real user environment

Because of this, a strict VSIX repackaging runbook was introduced.

Key principles enforced by the runbook:

1. BUILD IS EXPLICIT
   No implicit TypeScript transpilation is trusted.

2. INSTALL IS EXPLICIT
   The extension must be installed into the NORMAL VS Code instance,
   not assumed to be active because Dev Host worked.

3. VERIFICATION IS MANDATORY
   Mirroring, fingerprinting, encoding, and audit logging must be
   observed in real saves.

4. NO SILENT FAILURE
   If the extension fails to activate or log, work stops immediately.

This mirrors the broader project philosophy:

- Trust code, not memory
- Trust logs, not assumptions
- Trust enforcement, not intent

This runbook is deliberately repetitive and procedural.
That is a feature, not a flaw.

; ------------------------------------------------------------------
FUTURE NOTES
; ------------------------------------------------------------------

(Add dated notes below as decisions are made.)

[YYYY-MM-DD] —
- Decision:
- Reason:
- Impact:

; ------------------------------------------------------------------

END OF PROJECT WORKING NOTES SECTION (SECTION B)

; ------------------------------------------------------------------

END OF PROJECT ANCHOR MASTER