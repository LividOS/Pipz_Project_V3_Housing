; ------------------------------------------------------------------
; GEMINI MEM TAG (DO NOT EVER REMOVE OR EDIT) - MY FULL PATH IS "Pipz_Project_V3\Governance\PROJECT_LEARNED_CONSTRAINTS.txt"
; ------------------------------------------------------------------

; ------------------------------------------------------------------
; MAINTEMPLATE - PROJECT_LEARNED_CONSTRAINTS.txt
; Version: 0.1.1
; Last change: Populated with actual current plc entries.
; Content-Fingerprint: 2026-02-03T16-19-58Z-ZW4W1IAZ
; ------------------------------------------------------------------

; ------------------------------------------------------------------
; ALL CONTENT MUST GO BELOW THIS POINT(LINES 1-14 RESERVED)
; ------------------------------------------------------------------

; ------------------------------------------------------------------
; NON-AUTHORITATIVE NOTICE (MANDATORY)
; ------------------------------------------------------------------

This document records empirically discovered constraints, invalidated approaches, and
high-signal implementation notes to prevent regressions across sessions and AI systems.

This document does NOT:

; - Define governance rules
; - Override GOVERNANCE_COMPENDIUM.txt :: SECTION GOV.S1.AI_INSTRUCTIONS
; - Override GOVERNANCE_COMPENDIUM.txt :: SECTION GOV.S2.BOOTSTRAP_V4
; - Override GOVERNANCE_COMPENDIUM.txt :: SECTION GOV.S3.BLUEPRINT
; - Override GLOBAL_REGISTRY_MASTER.gsheet
; - Override GLOBAL_REGISTRY_MASTER.csv
; - Override registry ownership, structure, or invariants

If any entry in this document conflicts with authoritative sources:

; - The authoritative source wins
; - The conflict MUST be reported
; - The entry MUST NOT be used as justification for changes

This file is institutional memory only.

; ------------------------------------------------------------------
SCOPE INDEXING PROTOCOL (STRICT)
; ------------------------------------------------------------------

Every entry MUST contain a SCOPE field using the scope taxonomy below.
Entries MUST be written atomically and be independently verifiable.

Entries MUST be added only when:

; - An approach was explicitly invalidated (failed, incorrect, or regressive), OR
; - A constraint was explicitly confirmed (required to prevent breakage)

Narrative, opinions, and "best practices" without a confirmed outcome are prohibited.

; ------------------------------------------------------------------
SCOPE TAXONOMY (CANONICAL)
; ------------------------------------------------------------------

Use EXACTLY ONE SCOPE per entry (DEFINE NEW SCOPE IF NEEDED | NO DUAL SCOPES):

; - Governance
; - Bootstrap
; - Indexing
; - Phase5
; - Controller
; - Worker
; - Lib
; - CrossCutting
; - Infrastructure
; - Tooling
; - Orchestration
; - State_Management
; - Encoding
; - Audits
; - AI_Tooling_Limitation
; - AutoHotkey_v2_Logic

; ------------------------------------------------------------------
ENTRY FORMAT (STRICT | DO NOT OMIT ANY FIELD)
; ------------------------------------------------------------------

ENTRY ID: PLC-0000
DATE (UTC): YYYY-MM-DD
SCOPE: <one from taxonomy>
STATUS: CONFIRMED | INVALIDATED | DEPRECATED
TITLE: <short summary>

CONTEXT:
<What subsystem, file, or behavior was being worked on?>

DISCOVERY:
<What was learned? Factual, testable, and concise.>

INVALIDATED APPROACH:
<If STATUS=INVALIDATED, list the rejected method(s) here. Otherwise write: N/A>

VALIDATED CONSTRAINT:
<If STATUS=CONFIRMED, list the constraint(s) here. Otherwise write: N/A>

EVIDENCE:
<What observation confirms this? Logs, reproducible steps, file references, etc.>

RELATED FILES:
<List relevant project files (paths). Otherwise write: N/A>

NOTES:
<Optional. Must remain factual. Otherwise write: N/A>

; ------------------------------------------------------------------
SCOPE INDEX (MUST BE MAINTAINED)
; ------------------------------------------------------------------

Format:
SCOPE | ENTRY IDS

Governance            | PLC-0001, PLC-0002, PLC-0012
Bootstrap             | (none)
Indexing              | (none)
Phase5                | (none)
Controller            | (none)
Worker                | (none)
Lib                   | (none)
CrossCutting          | PLC-0003, PLC-0004, PLC-0005
Infrastructure        | PLC-0006
Tooling               | PLC-0007, PLC-0008
Orchestration         | (none)
State_Management      | (none)
Encoding              | (none)
Audits                | PLC-0009
AI_Tooling_Limitation | (none)
AutoHotkey_v2_Logic   | PLC-0010, PLC-0011

; ------------------------------------------------------------------
ENTRIES (APPEND ONLY BELOW THIS LINE)
; ------------------------------------------------------------------

ENTRY ID: PLC-0001
DATE (UTC): 2026-01-21
SCOPE: Governance
STATUS: CONFIRMED
TITLE: Google Drive preview truncates structured governance sections of GOVERNANCE_COMPENDIUM.txt unless formatting is normalized

CONTEXT:
AI governance and bootstrap files stored in Google Drive were intermittently unreadable or partially truncated when accessed via preview or connector-based reads.

DISCOVERY:
Google Drive preview and extraction systems may truncate or fail to fully render governance documents that contain dense structural formatting such as repeated ASCII delimiter blocks (e.g. "=====", "---"), mixed delimiter styles, or Markdown-like constructs, even when file size is small.

INVALIDATED APPROACH:
Storing governance sections of GOVERNANCE_COMPENDIUM.txt with mixed or stacked delimiters, Markdown horizontal rules, or long single-character separator blocks.

VALIDATED CONSTRAINT:
governance sections of GOVERNANCE_COMPENDIUM.txt must use a single, non-Markdown, commented delimiter style and avoid dense or mixed ASCII separator patterns to ensure full Drive preview and connector readability.

EVIDENCE:
Multiple governance sections of GOVERNANCE_COMPENDIUM.txt became fully readable in Drive only after delimiter normalization and removal of Markdown constructs; prior versions consistently truncated.

RELATED FILES:
GOVERNANCE_COMPENDIUM.txt :: SECTION GOV.S1.AI_INSTRUCTIONS
GOVERNANCE_COMPENDIUM.txt :: SECTION GOV.S3.BLUEPRINT
GOVERNANCE_COMPENDIUM.txt :: SECTION GOV.S4.ANCHOR_MASTER
GOVERNANCE_COMPENDIUM.txt :: SECTION GOV.S2.BOOTSTRAP_V4

NOTES:
This constraint was reproduced across multiple files and confirmed via Drive preview visibility to file end.

; ------------------------------------------------------------------

ENTRY ID: PLC-0002
DATE (UTC): 2026-01-21
SCOPE: CrossCutting
STATUS: CONFIRMED
TITLE: Canonical commented delimiter required for governance file stability

CONTEXT:
Multiple governance and audit files required normalization to ensure consistent readability and prevent Drive-based truncation.

DISCOVERY:
A single commented delimiter line is reliably treated as plain text by Google Drive preview and extraction systems, while legacy or Markdown-style delimiters are not.

INVALIDATED APPROACH:
Use of "=====", "---", mixed delimiter styles, or Markdown section separators in governance documents.

VALIDATED CONSTRAINT:
All governance and audit files must standardize on the canonical delimiter:
"; ------------------------------------------------------------------"

EVIDENCE:
After standardizing on this delimiter, all required governance sections of GOVERNANCE_COMPENDIUM.txt rendered fully in Drive preview and were readable end-to-end.

RELATED FILES:
GOVERNANCE_COMPENDIUM.txt :: SECTION GOV.S1.AI_INSTRUCTIONS
GOVERNANCE_COMPENDIUM.txt :: SECTION GOV.S3.BLUEPRINT
GOVERNANCE_COMPENDIUM.txt :: SECTION GOV.S8.LEARNED_CONSTRAINTS

NOTES:
Delimiter choice is formatting-only and does not confer authority.

; ------------------------------------------------------------------

ENTRY ID: PLC-0003
DATE (UTC): 2026-01-21
SCOPE: CrossCutting
STATUS: CONFIRMED
TITLE: UTF-16 mis-decoding can cause intermittent GEMINI path extraction failures in mirroring scripts

CONTEXT:
MirrorAhkToTxt.py intermittently logged "missing project path in GEMINI MEM TAG; skipping mirror" even when the GEMINI MEM TAG line was present.

DISCOVERY:
If runtime text is decoded incorrectly (e.g., UTF-8 bytes mis-decoded as UTF-16), header scanning and regex extraction may fail inconsistently across saves, sometimes triggered by small whitespace changes.

INVALIDATED APPROACH:
Blindly attempting UTF-16 decoding first for all buffer text without BOM/NUL detection.

VALIDATED CONSTRAINT:
Text decoding in mirroring/fingerprinting utilities must be BOM/NUL-aware: only prefer UTF-16 when strongly indicated (BOM or NUL bytes); otherwise prefer UTF-8.

EVIDENCE:
Header/path extraction failures occurred inconsistently until BOM/NUL-aware decoding was used, after which mirroring behaved deterministically across whitespace-only edits.

RELATED FILES:
Pipz_Project_V3\MirrorAhkToTxt.py (DEPRECIATED)

NOTES:
This is a tooling-layer constraint; it does not change governance semantics.

; ------------------------------------------------------------------

ENTRY ID: PLC-0004
DATE (UTC): 2026-01-21
SCOPE: CrossCutting
STATUS: CONFIRMED
TITLE: AI SOT header must exist only in .txt mirrors, never in runtime .ahk/.ini files

CONTEXT:
MirrorAhkToTxt.py showed inconsistent behavior and false "missing project path" errors during fingerprint/mirror operations.

DISCOVERY:
Placing the AI SOT mirror header inside a runtime file (.ahk/.ini) can interfere with header scanning assumptions and lead to incorrect mirroring/fingerprinting behavior.

INVALIDATED APPROACH:
Including the AI SOT header block inside runtime files.

VALIDATED CONSTRAINT:
Runtime files (.ahk/.ini) must contain only the GEMINI MEM TAG + MAINTEMPLATE header (with Content-Fingerprint). The AI SOT header is reserved exclusively for .txt mirror outputs.

EVIDENCE:
Removing the AI SOT header from runtime files restored deterministic fingerprinting and mirroring behavior.

RELATED FILES:
Pipz_Project_V3\MirrorAhkToTxt.py (DEPRECIATED)
Pipz_Project_V3\settings.ini
Pipz_Project_V3\settings.txt

NOTES:
This constraint prevents regression when normalizing headers and delimiters.

; ------------------------------------------------------------------

ENTRY ID: PLC-0005
DATE (UTC): 2026-01-21
SCOPE: CrossCutting
STATUS: CONFIRMED
TITLE: LLM whitespace cleanup can alter Python indentation and break MirrorAhkToTxt.py

CONTEXT:
MirrorAhkToTxt.py was passed through an external AI tool for "removing empty/unnecessary lines" to reduce visual bloat.

DISCOVERY:
LLM formatting passes can modify indentation or line structure even when instructed to only remove blank lines. In Python, indentation is semantic; accidental indentation changes can introduce syntax errors or change block structure.

INVALIDATED APPROACH:
Using an LLM to mass-remove blank lines or "normalize whitespace" in Python scripts without a deterministic verification step.

VALIDATED CONSTRAINT:
Whitespace cleanup for Python scripts must be mechanical and indentation-preserving (e.g., collapsing consecutive blank lines only) or must be followed by a strict syntax/indentation verification step before deployment.

EVIDENCE:
Gemini-cleaned MirrorAhkToTxt.py introduced an indentation change that required correction before the script could be treated as safe.

RELATED FILES:
Pipz_Project_V3\MirrorAhkToTxt.py (DEPRECIATED)

NOTES:
This is a tooling safety constraint; it does not change project governance semantics.

; ------------------------------------------------------------------

ENTRY ID: PLC-0006
DATE (UTC): 2026-01-25
SCOPE: Infrastructure
STATUS: CONFIRMED
TITLE: Google Drive .gsheet internal data is inaccessible to external connectors

CONTEXT:
Attempted use of Google Sheets as a live project registry for logic and state.

DISCOVERY:
The Google Drive API/connector exposes .gsheet files as metadata objects only; the tabular content (cells/tabs) is not streamable as raw text to the IDE or Gemini Code Assist.

INVALIDATED APPROACH:
Relying on .gsheet files for active project governance or state registries.

VALIDATED CONSTRAINT:
All project registries must exist as flat .csv files in the root registry directory to ensure visibility.

EVIDENCE:
Phase 2 Bootstrap failure on 2026-01-25; Agent reported file existence but "Zero content/Logic Blind" state.

RELATED FILES:
Pipz_Project_V3\Registry\GLOBAL_LOGIC_RULES.csv (DEPRECIATED)
Pipz_Project_V3\Registry\GLOBAL_FUNCTION_REGISTRY.csv (DEPRECIATED)

NOTES:
The .gsheet remains the non-active "Backup Vault".

; ------------------------------------------------------------------

ENTRY ID: PLC-0007
DATE (UTC): 2026-01-25
SCOPE: Tooling
STATUS: CONFIRMED
TITLE: Gemini Code Assist context window cannot parse multi-tab spreadsheet logic

CONTEXT:
Bootstrapping a project with complex registry dependencies involving multiple logic sheets.

DISCOVERY:
Current LLM tooling lacks the native ability to programmatically "switch tabs" or interpret spreadsheet-specific binary/XML formatting without high risk of hallucination.

INVALIDATED APPROACH:
Prompting the AI to "read Tab 2 of the registry sheet."

VALIDATED CONSTRAINT:
Governance data must be presented in flat, delimiter-heavy formats (CSV/TXT) to ensure high-fidelity LLM ingestion.

EVIDENCE:
Successful ingestion and audit only after transition to individual flat CSV files.

RELATED FILES:
Pipz_Project_V3\Registry\GLOBAL_LOGIC_RULES.csv (DEPRECIATED)

NOTES:
N/A

; ------------------------------------------------------------------

ENTRY ID: PLC-0008
DATE (UTC): 2026-01-25
SCOPE: Tooling
STATUS: CONFIRMED
TITLE: Gemini Code Assist Loop Detection Limit (Sequential Call Ceiling)

CONTEXT:
Sequential audit of 14+ files in a single turn using the code execution stream.

DISCOVERY:
The IDE execution stream triggers a 'loop_detected' error if sequential tool calls (read_file) exceed internal safety thresholds (~10-15 calls).

INVALIDATED APPROACH:
Running "Single-Sweep" audits or scans on more than 10 files in a single turn.

VALIDATED CONSTRAINT:
Automated processes must be segmented to reset the call counter every 5 operations.

EVIDENCE:
Error: "Unknown error from LLM stream: {'type':'loop_detected'}" encountered 2026-01-25.

RELATED FILES:
N/A

NOTES:
This is a technical safety ceiling of the Gemini Code Assist implementation.

; ------------------------------------------------------------------

ENTRY ID: PLC-0009
DATE (UTC): 2026-01-25
SCOPE: Audits
STATUS: CONFIRMED
TITLE: Mandatory Atomic Batching for Governance Verification

CONTEXT:
Performing Phase 5 Structural and Governance audits across a large codebase.

DISCOVERY:
Large-batch audits increase the risk of LLM "attention drift," leading to overlooked header errors or session timeouts.

INVALIDATED APPROACH:
Conducting full-project governance scans in a single prompt.

VALIDATED CONSTRAINT:
All governance audits must be executed in "Atomic Batches" of exactly 5 files to ensure 1:1 literal verification.

EVIDENCE:
PLC-0008 technical limitation; verification of 5-file batches results in 100% accuracy.

RELATED FILES:
Pipz_Project_V3\PHASE5_EXECUTION_CHECKLIST.txt (DEPRECIATED)
Pipz_Project_V3\PHASE5_VISIBILITY_AUDIT_TEMPLATE.txt (DEPRECIATED)

NOTES:
Governed by GLOBAL LOGIC RULE GEN-03.

; ------------------------------------------------------------------

ENTRY ID: PLC-0010
DATE (UTC): 2026-01-27
SCOPE: AutoHotkey_v2_Logic
STATUS: CONFIRMED
TITLE: SetTimer Static Method Callback Failure

CONTEXT:
Attempting to trigger a debounced log or function call using SetTimer within a static class method (e.g., Messenger.PushTitleUpdate).

DISCOVERY:
In AHK v2, referencing a static method as `this.MethodName` or `ClassName.MethodName` inside a `SetTimer` call throws "Error: Invalid callback function." The interpreter does not automatically treat these as Func objects in this context.

INVALIDATED APPROACH:
`SetTimer(this.MethodName, -1000)` or `SetTimer(Messenger.MethodName, -1000)`

EVIDENCE:
Runtime error thrown consistently in Pipz_Project_V3 Controller whenever the Game Window Title field was modified.

RELATED FILES:
Pipz_Project_V3\Controller\Modules\Messenger.ahk (DEPRECIATED)

NOTES:
This constraint is critical for maintaining stable execution of AHK v2 scripts that rely on timed callbacks within static methods.

; ------------------------------------------------------------------

ENTRY ID: PLC-0011
DATE (UTC): 2026-01-27
SCOPE: AutoHotkey_v2_Logic
STATUS: CONFIRMED
TITLE: Mandatory Method Binding for Class-Based Timers

CONTEXT:
Ensuring valid callbacks for SetTimer when the target function resides within a Class.

VALIDATED CONSTRAINT:
When passing a class method to `SetTimer`, it MUST be explicitly bound to the class or instance object to create a "BoundFunc" object.

VALIDATED APPROACH:
`SetTimer(ClassName.MethodName.Bind(ClassName), -1000)`

EVIDENCE:
Successful execution of the timer callback without errors in Pipz_Project_V3 Controller after applying the `.Bind()` method.

RELATED FILES:
Pipz_Project_V3\Controller\Modules\Messenger.ahk (DEPRECIATED)

NOTES:
This ensures the callback is recognized as a valid callable object by the AHK v2 runtime, regardless of whether the method actually requires the `this` parameter.

; ------------------------------------------------------------------

ENTRY ID: PLC-0012
DATE (UTC): 2026-01-28
SCOPE: Governance
STATUS: CONFIRMED
TITLE: Policy-B governed registry model with non-governed internal function index

CONTEXT:
The project governance layer was being updated following consolidation of modules
into core container files (Controller_Core, Worker_Core, Core_Utils, Humanoid, Interop),
and the introduction of a new INTERNAL_FUNCTION_INDEX.csv for full symbol discovery.

DISCOVERY:
Requiring all functions, variables, and helpers to be registered in a governed registry
creates excessive governance churn and hard-stops during refactors, consolidation,
and internal reorganization. Additionally, section-based registry assumptions
(GLOBAL_STATE_REGISTRY, GLOBAL_FUNCTION_REGISTRY, etc.) coupled to .gsheet sources
are incompatible with tooling visibility constraints.

INVALIDATED APPROACH:
Treating a monolithic or section-based registry (including gsheet-only registries)
as the authoritative source for all functions, variables, and logic.

VALIDATED CONSTRAINT:
The project SHALL use a dual-registry model:
- GLOBAL_REGISTRY_MASTER.csv is the authoritative, CSV-first, Policy-B governed registry.
- INTERNAL_FUNCTION_INDEX.csv is a non-governed, regenerable symbol inventory.

Policy-B governance applies ONLY to:
- Entrypoints (startup paths, externally-triggered handlers)
- Timers (SetTimer callbacks)
- OnMessage handlers / IPC receivers
- IPC sender contracts and encodings
- Settings IO and Defaults interface
- Lifecycle and process controls
- Logic invariants directly tied to the above surface area

Internal helpers and non-surface logic MUST NOT require governed registration.

EVIDENCE:
Governance refactor eliminated stale module references, reduced registry churn,
and aligned registry verification with tooling-readable CSV artifacts while preserving
auditability of governance-critical surface area.

RELATED FILES:
Pipz_Project_V3\Registry\GLOBAL_REGISTRY_MASTER.csv
Pipz_Project_V3\Registry\INTERNAL_FUNCTION_INDEX.csv
GOVERNANCE_COMPENDIUM.txt :: SECTION GOV.S1.AI_INSTRUCTIONS
GOVERNANCE_COMPENDIUM.txt :: SECTION GOV.S3.BLUEPRINT
GOVERNANCE_COMPENDIUM.txt :: SECTION GOV.S2.BOOTSTRAP_V4

NOTES:
This entry supersedes prior assumptions that all functions or variables must appear
in a governed registry and formally establishes Policy-B semantics for future work.

; ------------------------------------------------------------------

(NEXT ENTRY GOES BELOW THIS LINE)